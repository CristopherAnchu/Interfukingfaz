<div class="admin-container">
    <header class="admin-header">
        <img src="img/uleam_logo.png" alt="logo">
        <h1>Panel de Administración</h1>
        <p>Bienvenido <span>{{ currentUser?.nombre }} {{ currentUser?.apellido }}</span></p>
        <div class="admin-header-actions">
          <div class="language-selector-admin">
            <button (click)="toggleLanguage()" class="lang-btn-admin" [title]="'Cambiar idioma'">
              <mat-icon>language</mat-icon>
              <span class="lang-text">{{ getCurrentLanguage() }}</span>
            </button>
            <div class="lang-dropdown-admin" *ngIf="isLanguageOpen">
              <button (click)="changeLanguage('es')" [class.active]="currentLanguage === 'es'">
                <span class="flag">ES</span> Español
              </button>
              <button (click)="changeLanguage('en')" [class.active]="currentLanguage === 'en'">
                <span class="flag">EN</span> English
              </button>
            </div>
          </div>
          <button (click)="logout()" class="logout-button"> {{ i18n.translate('home.logout') }} </button>
        </div>
    </header>

    <section class="add-user-section">

        <h2>{{ i18n.translate('admin.addUser') }}</h2>

        <form [formGroup]="addUserForm" (ngSubmit)="onSubmit()">

            <div class="form-group">
                <label for="nombres">{{ i18n.translate('admin.name') }}:</label>
                <input type="text" id="nombres" formControlName="nombres" [placeholder]="i18n.translate('admin.name')" required>
            </div>

            <div class="form-group">
                <label for="apellidos">{{ i18n.translate('admin.lastname') }}:</label>
                <input type="text" id="apellidos" formControlName="apellidos" [placeholder]="i18n.translate('admin.lastname')" required>
            </div>

            <div class="form-group">
                <label for="cedula">{{ i18n.translate('admin.id') }}:</label>
                <input type="text" id="cedula" formControlName="cedula" placeholder="10 dígitos" maxlength="10" required>
            </div>

            <div class="form-group">
                <label for="fechaNacimiento">{{ i18n.translate('admin.birthdate') }}:</label>
                <input type="date" id="fechaNacimiento" formControlName="fechaNacimiento" required>
            </div>

            <div class="form-group">
                <label for="email">{{ i18n.translate('admin.email') }} ULEAM:</label>
                <input type="email" id="email" formControlName="email" placeholder="eXXXXXXXXXXnombre@live.uleam.edu.ec" required>
            </div>

            <div class="form-group">
                <label for="password">{{ i18n.translate('admin.password') }}:</label>
                <input type="password" id="password" formControlName="password" required>
            </div>

            <button type="submit" class="primary" [disabled]="addUserForm.invalid">{{ i18n.translate('admin.addUser') }}</button>
        </form>

        <div 
            *ngIf="message" 
            class="message"
            [ngClass]="messageType">
            {{message}}
        </div>

    </section>

    <section class="user-management-section">
        <h2>{{ i18n.translate('admin.title') }}</h2>
        
        <div class="search-bar">
            <input type="search"
            [placeholder]="i18n.translate('admin.search')"
            (input)="onsearch($event)">
        </div>

        <div class="table-responsive">
            <table>
                <thead>

                    <tr>
                        <th>Nombres</th>
                        <th>Apellidos</th>
                        <th>Cédula</th>
                        <th>Email</th>
                        <th>Edad</th>
                        <th>Acciones</th>
                    </tr>

                </thead>

                <tbody>

                    <tr *ngFor="let user of filteredUsers">

                        <td> {{ user.nombres }} </td>
                        <td> {{ user.apellidos }} </td>
                        <td> {{user.cedula}} </td>
                        <td> {{ user.email }} </td>
                        <td> {{ CalculateAge(user.fechaNacimiento) }} años</td>
                        <td>
                            <button class="primary" (click)="EditUser(user)">Editar</button>
                            <button class="danger" (click)="DeleteUser(user)">Eliminar</button>
                        </td>

                    </tr>

                    <tr *ngIf="filteredUsers.length===0">
                        <td colspan="6" style="text-align: center;">{{ i18n.translate('admin.noUsers') }}</td>
                    </tr>

                </tbody>

            </table>

        </div>

    </section>

    <!-- Modal de Edición de Usuario -->
    <div class="modal-overlay" *ngIf="isEditModalOpen" (click)="closeEditModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header flex flex-row justify-between">
                <h2>Editar Usuario</h2>
                <button class="close-btn" (click)="closeEditModal()">
                    <mat-icon>close</mat-icon>
                </button>
            </div>

            <form [formGroup]="editUserForm" (ngSubmit)="onSubmitEditUser()">
                <div class="form-group">
                    <label for="edit-nombres">Nombres:</label>
                    <input type="text" id="edit-nombres" formControlName="nombres" required>
                </div>

                <div class="form-group">
                    <label for="edit-apellidos">Apellidos:</label>
                    <input type="text" id="edit-apellidos" formControlName="apellidos" required>
                </div>

                <div class="form-group">
                    <label for="edit-email">Email:</label>
                    <input type="email" id="edit-email" formControlName="email" required>
                </div>

                <div class="form-group">
                    <label for="edit-fechaNacimiento">Fecha de Nacimiento:</label>
                    <input type="date" id="edit-fechaNacimiento" formControlName="fechaNacimiento" required>
                </div>

                <div class="form-group">
                    <label for="edit-password">Nueva Contraseña (dejar vacío para no cambiar):</label>
                    <input type="password" id="edit-password" formControlName="password">
                </div>

                <div class="modal-actions">
                    <button type="button" class="cancel-btn" (click)="closeEditModal()">Cancelar</button>
                    <button type="submit" class="primary" [disabled]="editUserForm.invalid">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

</div>