<div class="container user-container">
  <aside class="sidebar">
    <img src="img/uleam_logo.png" alt="Logo ULEAM">
    <nav class="nav-menu">
      <button (click)="goToFeed()" class="secondary">
        <mat-icon>arrow_back</mat-icon> {{ i18n.translate('home.backToFeed') }}
      </button>
      <button 
        [class.active]="currentView === 'myFiles'"
        (click)="setView('myFiles')">
        <mat-icon>folder</mat-icon> {{ i18n.translate('home.myFiles') }}
      </button>
      <button 
        [class.active]="currentView === 'receivedFiles'"
        (click)="setView('receivedFiles'); markDocumentsAsRead()">
        <mat-icon>inbox</mat-icon> {{ i18n.translate('home.receivedFiles') }}
      </button>
      <button 
        [class.active]="currentView === 'myDrive'"
        (click)="setView('myDrive')">
        <mat-icon>storage</mat-icon> {{ i18n.translate('home.myDrive') }}
      </button>
      <button 
        [class.active]="currentView === 'uploadForm'"
        (click)="setView('uploadForm')">
        <mat-icon>upload</mat-icon> {{ i18n.translate('home.uploadFile') }}
      </button>
    </nav>
    <button (click)="logout()" class="secondary">
      <mat-icon>logout</mat-icon> {{ i18n.translate('home.logout') }}
    </button>
  </aside>

  <main class="main-content">
    <header class="main-header">
      <div class="header-left">
        <h1>{{ getViewTitle() }}</h1>
      </div>
      <div class="header-center" *ngIf="!showUploadForm">
        <input 
          type="search"
          [placeholder]="i18n.translate('home.search')"
          [value]="searchTerm"
          (input)="onSearch($event)">
        <button 
          (click)="toggleTagsFilter()"
          class="secondary"
          [class.active-filter]="selectedTags.length > 0">
          <mat-icon>filter_list</mat-icon>
          {{ selectedTags.length > 0 ? i18n.translate('home.filter') + ' (' + selectedTags.length + ')' : i18n.translate('home.filter') }}
        </button>
      </div>
      <div class="header-right">
        <div class="language-selector">
          <button (click)="toggleLanguage()" class="lang-btn" [title]="'Cambiar idioma'">
            <mat-icon>language</mat-icon>
            <span class="lang-text">{{ getCurrentLanguage() }}</span>
            <mat-icon class="dropdown-icon">expand_more</mat-icon>
          </button>
          <div class="lang-dropdown" *ngIf="isLanguageOpen">
            <button (click)="changeLanguage('es')" [class.active]="currentLanguage === 'es'" class="lang-option">
              <span class="flag">ES</span> Español
            </button>
            <button (click)="changeLanguage('en')" [class.active]="currentLanguage === 'en'" class="lang-option">
              <span class="flag">EN</span> English
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Content Area -->
    <section class="content-area" *ngIf="!showUploadForm">
      <div class="document-grid-view" *ngIf="filteredDocuments.length > 0">
        <div 
          *ngFor="let doc of filteredDocuments"
          class="document-icon-item file-item"
          (click)="openDocument(doc)"
          (contextmenu)="onDocumentRightClick($event, doc)">
          <div class="item-icon-wrapper">
            <mat-icon>{{ getFileIcon(doc.fileType) }}</mat-icon>
          </div>
          <span class="document-name">{{ doc.fileName }}</span>
        </div>
      </div>
      <p *ngIf="filteredDocuments.length === 0" class="empty-message">
        {{ i18n.translate('home.noDocuments') }}
      </p>
    </section>

    <!-- Upload Form -->
    <div class="upload-form-container" *ngIf="showUploadForm">
      <h2>{{ i18n.translate('upload.title') }}</h2>
      <form [formGroup]="uploadForm" (ngSubmit)="onUploadSubmit()">
        <div class="form-group">
          <label for="numero">{{ i18n.translate('upload.number') }}</label>
          <input type="text" id="numero" formControlName="numero" required>
        </div>
        <div class="form-group">
          <label for="tipo">{{ i18n.translate('upload.type') }}</label>
          <input type="text" id="tipo" formControlName="tipo" required>
        </div>
        <div class="form-group">
          <label for="asunto">{{ i18n.translate('upload.subject') }}</label>
          <input type="text" id="asunto" formControlName="asunto" required>
        </div>
        <div class="form-group">
          <label for="descripcion">Descripción del Documento</label>
          <textarea id="descripcion" formControlName="descripcion" placeholder="Ingrese una descripción sobre el documento..." rows="4" required></textarea>
        </div>
        <div class="form-group">
          <label for="paraQuienEsEmail">{{ i18n.translate('upload.recipient') }}</label>
          <input 
            type="email"
            id="paraQuienEsEmail"
            formControlName="paraQuienEsEmail"
            placeholder="e-XXXXXXXXXX-nombre@live.uleam.edu.ec"
            (input)="onEmailInput($event)"
            required>
          <ul class="autocomplete-list" *ngIf="showAutocomplete">
            <li (click)="selectUser(null)">Todos</li>
            <li 
              *ngFor="let user of autocompleteUsers"
              (click)="selectUser(user)">
              {{ user.nombres }} {{ user.apellidos }} ({{ user.email }})
            </li>
          </ul>
        </div>
        <div class="form-group">
          <label for="file">{{ i18n.translate('upload.file') }}</label>
          <input type="file" id="file" (change)="onFileSelected($event)" required>
        </div>
        <div class="form-group">
          <label for="etiquetas">{{ i18n.translate('upload.tags') }}</label>
          <input 
            type="text"
            id="etiquetas"
            formControlName="etiquetas"
            [placeholder]="i18n.translate('upload.tagsPlaceholder')">
        </div>
        <button type="submit" class="primary" [disabled]="uploadForm.invalid">
          {{ i18n.translate('upload.submit') }}
        </button>
        <div 
          *ngIf="message"
          class="message"
          [ngClass]="messageType">
          {{ message }}
        </div>
      </form>
    </div>
  </main>
</div>

<!-- Tags Filter Panel -->
<div class="tags-filter-panel" *ngIf="showTagsFilter" (click)="showTagsFilter = false">
  <div class="filter-content" (click)="$event.stopPropagation()">
    <div class="filter-header">
      <h3>{{ i18n.translate('filter.title') }}</h3>
      <span class="close-filter" (click)="showTagsFilter = false">&times;</span>
    </div>
    <div class="tags-container">
      <div 
        *ngFor="let tag of allTags"
        class="tag-item"
        [class.selected]="selectedTags.includes(tag)"
        (click)="toggleTag(tag)">
        <input 
          type="checkbox"
          [checked]="selectedTags.includes(tag)"
          (click)="$event.stopPropagation()">
        <label>{{ tag }}</label>
      </div>
    </div>
    <div class="filter-actions">
      <button (click)="applyFilters(); showTagsFilter = false" class="primary">
        {{ i18n.translate('filter.apply') }}
      </button>
      <button (click)="clearFilters(); showTagsFilter = false" class="secondary">
        {{ i18n.translate('filter.clear') }}
      </button>
    </div>
  </div>
</div>

<!-- Document Modal -->
<app-document-model
  [isVisible]="showDocumentModal"
  [document]="selectedDocument"
  (closeModal)="showDocumentModal = false">
</app-document-model>

<!-- Context Menu -->
<app-context-menu
  [isVisible]="showContextMenu"
  [position]="contextMenuPosition"
  [actions]="contextMenuActions"
  (actionSelected)="onContextMenuAction($event)">
</app-context-menu>
